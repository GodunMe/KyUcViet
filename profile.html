<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Profile - Vietnamese Memories</title>
  <link rel="icon" type="image/png" href="logo.PNG" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <!-- User Header -->
    <div class="user-header" id="userHeader">
      <!-- User logged in state -->
      <div id="userLoggedIn" class="user-logged-in" style="display: none;">
        <div class="user-info">
          <img id="userAvatar" src="avatar/default.png" alt="User" class="user-icon">
          <span id="userName" class="user-name">Loading...</span>
        </div>
        <div class="user-points">
          <span id="userPoints">0Ä‘</span>
        </div>
      </div>
      
      <!-- User not logged in state -->
      <div id="usernotLoggedIn" class="user-not-logged-in" style="display: none;">
        <div class="login-prompt">
          <span class="login-text">ÄÄƒng nháº­p Ä‘á»ƒ xem thÃ´ng tin cÃ¡ nhÃ¢n</span>
        </div>
        <button class="login-btn" onclick="goToLogin()">
          ğŸ”‘ ÄÄƒng nháº­p
        </button>
      </div>
    </div>

    <!-- Profile Header -->
    <div class="profile-header">
      <div class="profile-avatar">
        <img src="avatar.png" alt="User Avatar" id="profileAvatar">
        <button class="change-avatar-btn" onclick="changeAvatar()">ğŸ“·</button>
      </div>
      <h2 id="profileName">Nguyen Van A</h2>
      <p id="profileBio">NgÆ°á»i Ä‘am mÃª khÃ¡m phÃ¡ vÄƒn hÃ³a Viá»‡t Nam</p>
      <button class="edit-profile-btn" onclick="toggleEditMode()">âœï¸ Chá»‰nh sá»­a</button>
    </div>

    <!-- Stats Section -->
    <div class="stats-section">
      <div class="stat-card">
        <div class="stat-number">189</div>
        <div class="stat-label">Äiá»ƒm</div>
      </div>
      <div class="stat-card">
        <div class="stat-number">8</div>
        <div class="stat-label">Check-ins</div>
      </div>
      <div class="stat-card">
        <div class="stat-number">5</div>
        <div class="stat-label">Báº£o tÃ ng</div>
      </div>
      <div class="stat-card">
        <div class="stat-number">#7</div>
        <div class="stat-label">Xáº¿p háº¡ng</div>
      </div>
    </div>

    <!-- Achievement Section -->
    <div class="achievement-section">
      <h3>ğŸ… ThÃ nh tÃ­ch</h3>
      <div class="achievement-grid">
        <div class="achievement-card earned">
          <div class="achievement-icon">ğŸ›ï¸</div>
          <div class="achievement-name">KhÃ¡m phÃ¡ Ä‘áº§u tiÃªn</div>
          <div class="achievement-desc">Check-in láº§n Ä‘áº§u</div>
        </div>
        <div class="achievement-card earned">
          <div class="achievement-icon">ğŸ“</div>
          <div class="achievement-name">ThÃ¡m hiá»ƒm</div>
          <div class="achievement-desc">5 check-ins</div>
        </div>
        <div class="achievement-card">
          <div class="achievement-icon">ğŸ¯</div>
          <div class="achievement-name">ChuyÃªn gia</div>
          <div class="achievement-desc">10 check-ins</div>
        </div>
        <div class="achievement-card">
          <div class="achievement-icon">ğŸ‘‘</div>
          <div class="achievement-name">Báº­c tháº§y</div>
          <div class="achievement-desc">Top 3 tuáº§n</div>
        </div>
      </div>
    </div>

    <!-- Recent Activity -->
    <div class="activity-section">
      <h3>ğŸ“‹ Hoáº¡t Ä‘á»™ng gáº§n Ä‘Ã¢y</h3>
      <div class="activity-list">
        <div class="activity-item">
          <div class="activity-icon">ğŸ“</div>
          <div class="activity-info">
            <p><strong>Check-in táº¡i Báº£o tÃ ng Há»“ ChÃ­ Minh</strong></p>
            <p class="activity-time">HÃ´m nay, 14:30</p>
          </div>
          <div class="activity-points">+25</div>
        </div>
        <div class="activity-item">
          <div class="activity-icon">ğŸ†</div>
          <div class="activity-info">
            <p><strong>LÃªn háº¡ng 7</strong></p>
            <p class="activity-time">HÃ´m nay, 14:31</p>
          </div>
        </div>
        <div class="activity-item">
          <div class="activity-icon">ğŸ“</div>
          <div class="activity-info">
            <p><strong>Check-in táº¡i Báº£o tÃ ng Lá»‹ch sá»­ QuÃ¢n sá»±</strong></p>
            <p class="activity-time">HÃ´m qua, 10:15</p>
          </div>
          <div class="activity-points">+30</div>
        </div>
        <div class="activity-item">
          <div class="activity-icon">ğŸ…</div>
          <div class="activity-info">
            <p><strong>Nháº­n thÃ nh tÃ­ch "ThÃ¡m hiá»ƒm"</strong></p>
            <p class="activity-time">HÃ´m qua, 10:16</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Settings Section -->
    <div class="settings-section">
      <h3>âš™ï¸ CÃ i Ä‘áº·t</h3>
      <div class="settings-list">
        <div class="setting-item" onclick="toggleNotifications()">
          <div class="setting-info">
            <div class="setting-name">ThÃ´ng bÃ¡o</div>
            <div class="setting-desc">Nháº­n thÃ´ng bÃ¡o vá» hoáº¡t Ä‘á»™ng má»›i</div>
          </div>
          <div class="setting-toggle">
            <input type="checkbox" id="notifications" checked>
            <label for="notifications" class="toggle-switch"></label>
          </div>
        </div>
        <div class="setting-item" onclick="toggleLocation()">
          <div class="setting-info">
            <div class="setting-name">Vá»‹ trÃ­</div>
            <div class="setting-desc">Cho phÃ©p truy cáº­p vá»‹ trÃ­</div>
          </div>
          <div class="setting-toggle">
            <input type="checkbox" id="location" checked>
            <label for="location" class="toggle-switch"></label>
          </div>
        </div>
        <div class="setting-item" onclick="showPrivacySettings()">
          <div class="setting-info">
            <div class="setting-name">Quyá»n riÃªng tÆ°</div>
            <div class="setting-desc">Quáº£n lÃ½ quyá»n riÃªng tÆ°</div>
          </div>
          <div class="setting-arrow">â–¶</div>
        </div>
        <div class="setting-item logout-item" onclick="logout()">
          <div class="setting-info">
            <div class="setting-name">ÄÄƒng xuáº¥t</div>
            <div class="setting-desc">ThoÃ¡t khá»i tÃ i khoáº£n</div>
          </div>
          <div class="setting-arrow">ğŸšª</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bottom Navigation -->
  <div class="bottom-nav">
    <div class="nav-item" onclick="navigateToPage('home')">
      <div class="nav-icon">ğŸ </div>
      <div class="nav-label">Home</div>
    </div>
    <div class="nav-item" onclick="navigateToPage('map')">
      <div class="nav-icon">ğŸ—ºï¸</div>
      <div class="nav-label">Map</div>
    </div>
    <div class="nav-item" onclick="navigateToPage('checkin')">
      <div class="nav-icon">ğŸ“</div>
      <div class="nav-label">Check-in</div>
    </div>
    <div class="nav-item" onclick="navigateToPage('leaderboard')">
      <div class="nav-icon">ğŸ†</div>
      <div class="nav-label">Báº£ng xáº¿p háº¡ng</div>
    </div>
    <div class="nav-item active" onclick="navigateToPage('profile')">
      <div class="nav-icon">ğŸ‘¤</div>
      <div class="nav-label">Profile</div>
    </div>
  </div>

  <script>
    // Load user info on page load
    async function loadUserInfo() {
      try {
        const response = await fetch('getUserInfo.php');
        if (response.ok) {
          const data = await response.json();
          
          if (data.loggedIn) {
            showUserLoggedInState(data);
          } else {
            showUserNotLoggedInState();
          }
        } else {
          showUserNotLoggedInState();
        }
      } catch (error) {
        console.error('Error loading user info:', error);
        showUserNotLoggedInState();
      }
    }

    function showUserLoggedInState(userData) {
      const loggedInDiv = document.getElementById('userLoggedIn');
      const notLoggedInDiv = document.getElementById('usernotLoggedIn');
      
      // Show logged in state, hide not logged in state
      loggedInDiv.style.display = 'flex';
      notLoggedInDiv.style.display = 'none';
      
      // Update user avatar
      const avatarElement = document.getElementById('userAvatar');
      avatarElement.src = userData.avatarRelative || 'avatar/default.png';
      
      // Update user name
      const nameElement = document.getElementById('userName');
      nameElement.textContent = userData.username || 'Guest User';
      
      // Update user points
      const pointsElement = document.getElementById('userPoints');
      pointsElement.textContent = (userData.score || 0) + 'Ä‘';
      
      // Update profile information
      const profileName = document.getElementById('profileName');
      if (profileName) profileName.textContent = userData.username || 'Guest User';
      
      const profileAvatar = document.getElementById('profileAvatar');
      if (profileAvatar) profileAvatar.src = userData.avatarRelative || 'avatar/default.png';
    }

    function showUserNotLoggedInState() {
      const loggedInDiv = document.getElementById('userLoggedIn');
      const notLoggedInDiv = document.getElementById('usernotLoggedIn');
      
      // Show not logged in state, hide logged in state
      loggedInDiv.style.display = 'none';
      notLoggedInDiv.style.display = 'flex';
    }

    function goToLogin() {
      // Redirect to login page
      window.location.href = 'login.php?token=1';
    }

    // Navigation functions
    function navigateToPage(page) {
      document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
      });
      
      event.target.closest('.nav-item').classList.add('active');
      
      switch(page) {
        case 'home':
          window.location.href = '/EXEProject/index.php';
          break;
        case 'map':
          window.location.href = '/EXEProject/map.html';
          break;
        case 'checkin':
          window.location.href = '/EXEProject/checkin.html';
          break;
        case 'leaderboard':
          window.location.href = '/EXEProject/leaderboard.html';
          break;
        case 'profile':
          // Already on profile page
          break;
      }
    }

    // Profile functions
    function toggleEditMode() {
      const isEditing = document.querySelector('.edit-mode');
      if (isEditing) {
        exitEditMode();
      } else {
        enterEditMode();
      }
    }

    function enterEditMode() {
      document.body.classList.add('edit-mode');
      const name = document.getElementById('profileName');
      const bio = document.getElementById('profileBio');
      const editBtn = document.querySelector('.edit-profile-btn');
      
      const nameInput = document.createElement('input');
      nameInput.type = 'text';
      nameInput.value = name.innerText;
      nameInput.id = 'nameInput';
      nameInput.className = 'profile-input';
      
      const bioInput = document.createElement('textarea');
      bioInput.value = bio.innerText;
      bioInput.id = 'bioInput';
      bioInput.className = 'profile-input';
      
      name.replaceWith(nameInput);
      bio.replaceWith(bioInput);
      editBtn.innerHTML = 'ğŸ’¾ LÆ°u';
    }

    function exitEditMode() {
      document.body.classList.remove('edit-mode');
      const nameInput = document.getElementById('nameInput');
      const bioInput = document.getElementById('bioInput');
      const editBtn = document.querySelector('.edit-profile-btn');
      
      const name = document.createElement('h2');
      name.id = 'profileName';
      name.innerText = nameInput.value;
      
      const bio = document.createElement('p');
      bio.id = 'profileBio';
      bio.innerText = bioInput.value;
      
      nameInput.replaceWith(name);
      bioInput.replaceWith(bio);
      editBtn.innerHTML = 'âœï¸ Chá»‰nh sá»­a';
      
      // Here you would save to server
      console.log('Profile saved:', { name: name.innerText, bio: bio.innerText });
    }

    function changeAvatar() {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = 'image/*';
      input.onchange = function(e) {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function(e) {
            document.getElementById('profileAvatar').src = e.target.result;
          };
          reader.readAsDataURL(file);
        }
      };
      input.click();
    }

    function toggleNotifications() {
      const checkbox = document.getElementById('notifications');
      checkbox.checked = !checkbox.checked;
      console.log('Notifications:', checkbox.checked);
    }

    function toggleLocation() {
      const checkbox = document.getElementById('location');
      checkbox.checked = !checkbox.checked;
      console.log('Location:', checkbox.checked);
    }

    function showPrivacySettings() {
      alert('CÃ i Ä‘áº·t quyá»n riÃªng tÆ° sáº½ Ä‘Æ°á»£c phÃ¡t triá»ƒn trong phiÃªn báº£n tiáº¿p theo');
    }

    function logout() {
      if (confirm('Báº¡n cÃ³ cháº¯c muá»‘n Ä‘Äƒng xuáº¥t?')) {
        window.location.href = '/KyUcViet/login.html';
      }
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', function() {
      loadUserInfo();
      console.log('Profile page loaded');
    });
  </script>
</body>
</html>